@page "/Day03"
@page "/Day3"
@inject DataFetcher dataFetcher

<PageTitle>AoC 2025 - Day @dayNumber</PageTitle>

<ChallengeContainer DayNumber=@dayNumber
                    @bind-ChallengeInput=@inputData
                    @bind-TestInput=@testData
                    SolveChallenge1=@SolveChallenge1
                    SolveChallenge2=@SolveChallenge2
                    Challenge1Result=@challenge1Result.ToString()
                    Challenge2Result=@challenge2Result.ToString() />

@code {
    private readonly int dayNumber = 3;
    string inputData = string.Empty;
    string testData = string.Empty;
    private int? challenge1Result = null;
    private long? challenge2Result = null;

    private async Task LoadData()
    {
        inputData = await dataFetcher.FetchDataAsync(dayNumber);
        testData = TestData.Day3;
    }

    protected override async Task OnInitializedAsync()
    {
        await LoadData();
    }

    private int Challenge1Solution(string input)
    {
        int accumulator = 0;

        // Parse string into an array of strings, each string is a line of the input
        string[] parsedInputData = inputData.Split("\n", StringSplitOptions.RemoveEmptyEntries | StringSplitOptions.TrimEntries);

        foreach (string batteryBank in parsedInputData)
        {
            int firstDigit = -1;
            int firstDigitIndex = 0;

            // Find the highest digit in the battery bank except for the last value
            for (int i = 0; i < batteryBank.Length - 1; i++)
            {
                char c = batteryBank[i];
                if (char.IsDigit(c))
                {
                    int d = c - '0';
                    if (d > firstDigit)
                    {
                        firstDigit = d;
                        firstDigitIndex = i;
                        if (firstDigit == 9)
                        {
                            break; // Early exit: cannot get higher than 9
                        }
                    }
                }
            }

            int secondDigit = -1;

            // Find the highest digit in the battery bank starting at the position after the first digit found
            for (int i = firstDigitIndex + 1; i < batteryBank.Length; i++)
            {
                char c = batteryBank[i];
                if (char.IsDigit(c))
                {
                    int d = c - '0';
                    if (d > secondDigit)
                    {
                        secondDigit = d;
                        if (secondDigit == 9)
                        {
                            break; // Early exit: cannot get higher than 9
                        }
                    }
                }
            }

            accumulator += int.Parse($"{firstDigit}{secondDigit}");
        }

        return accumulator;
    }

    private void SolveChallenge1()
    {
        if (inputData != string.Empty)
        {
            try
            {
                challenge1Result = Challenge1Solution(inputData);
            }
            catch (Exception ex)
            {
                Console.WriteLine(ex.Message);
            }
        }
    }

    // Challenge 2
    private long Challenge2Solution(string input)
    {
        long accumulator = 0;

        // Parse string into an array of strings, each string is a line of the input
        string[] parsedInputData = inputData.Split("\n", StringSplitOptions.RemoveEmptyEntries | StringSplitOptions.TrimEntries);

        foreach (string batteryBank in parsedInputData)
        {
            string batteryBankDigits = string.Empty;
            int previousHighestDigitIndex = -1;

            for (int b = 1; b <= 12; b++)
            {
                int highestDigit = -1;
                int highestDigitIndex = 0;

                // Find the highest digit in the battery bank except for the last value
                for (int i = previousHighestDigitIndex + 1; i < batteryBank.Length - (12 - b); i++)
                {
                    char c = batteryBank[i];
                    if (char.IsDigit(c))
                    {
                        int d = c - '0';
                        if (d > highestDigit)
                        {
                            highestDigit = d;
                            highestDigitIndex = i;
                            previousHighestDigitIndex = i;
                            if (highestDigit == 9)
                            {
                                break; // Early exit: cannot get higher than 9
                            }
                        }
                    }
                }
                batteryBankDigits += highestDigit.ToString();
            }

            accumulator += long.Parse(batteryBankDigits);
        }

        return accumulator;
    }

    private void SolveChallenge2()
    {
        if (inputData != string.Empty)
        {
            try
            {
                challenge2Result = Challenge2Solution(inputData);
            }
            catch (Exception ex)
            {
                Console.WriteLine(ex.Message);
            }
        }
    }
}
