@page "/Day07"
@page "/Day7"
@inject DataFetcher dataFetcher

<PageTitle>AoC 2025 - Day @dayNumber</PageTitle>

<ChallengeContainer DayNumber=@dayNumber 
                    @bind-ChallengeInput=@inputData
                    @bind-TestInput=@testData
                    SolveChallenge1=@SolveChallenge1
                    SolveChallenge2=@SolveChallenge2
                    Challenge1Result=@challenge1Result.ToString()
                    Challenge2Result=@challenge2Result.ToString()
/>

@code {
    private readonly int dayNumber = 7;
    string inputData = string.Empty;
    string testData = string.Empty;
    private int? challenge1Result = null;
    private long? challenge2Result = null;

    private async Task LoadData()
    {
        inputData = await dataFetcher.FetchDataAsync(dayNumber);
        testData = TestData.Day7;
    }

    protected override async Task OnInitializedAsync()
    {
        await LoadData();
    }

    private int Challenge1Solution(string input)
    {
        int accumulator = 0;

        // Parse string into an array of strings, each string is a line of the input
        string[] parsedInputData = inputData.Split("\n", StringSplitOptions.RemoveEmptyEntries | StringSplitOptions.TrimEntries);

        // Parse lines into a 2D character array
        if (parsedInputData.Length == 0)
        {
            throw new FileNotFoundException("No data was provided");
        }

        int rows = parsedInputData.Length;
        int cols = parsedInputData[0].Length;

        char[,] splitterMap = new char[rows, cols];

        // Copy the first row into the splitterMap
        for (int c = 0; c < cols; c++)
        {
            splitterMap[0, c] = parsedInputData[0][c];
        }

        for (int r = 1; r < rows; r++)
        {
            for (int c = 0; c < cols; c++)
            {
                char precedingChar = splitterMap[r - 1, c];
                char currentChar = parsedInputData[r][c];

                if ((precedingChar == 'S' || precedingChar == '|') && currentChar == '.')
                {
                    splitterMap[r, c] = '|';
                }
                else if (precedingChar == '|' && currentChar == '^')
                {
                    splitterMap[r, c - 1] = '|';
                    splitterMap[r, c] = currentChar;
                    splitterMap[r, c + 1] = '|';
                    c++;
                    accumulator++;
                }
                else
                {
                    splitterMap[r, c] = currentChar;
                }
            }
        }

        WriteMapToConsole(splitterMap);

        return accumulator;
    }

    private void SolveChallenge1()
    {
        if (inputData != string.Empty)
        {
            try
            {
                challenge1Result = Challenge1Solution(inputData);
            }
            catch (Exception ex)
            {
                Console.WriteLine(ex.Message);
            }
        }
    }

    // Challenge 2
    private long Challenge2Solution(string input)
    {
        long accumulator = 0;

        // Parse string into an array of strings, each string is a line of the input
        string[] parsedInputData = inputData.Split("\n", StringSplitOptions.RemoveEmptyEntries | StringSplitOptions.TrimEntries);

        // Parse lines into a 2D character array
        if (parsedInputData.Length == 0)
        {
            throw new FileNotFoundException("No data was provided");
        }

        int rows = parsedInputData.Length;
        int cols = parsedInputData[0].Length;

        char[,] splitterMap = new char[rows, cols];

        // Copy the first row into the splitterMap
        for (int c = 0; c < cols; c++)
        {
            splitterMap[0, c] = parsedInputData[0][c];
        }

        for (int r = 1; r < rows; r++)
        {
            for (int c = 0; c < cols; c++)
            {
                char precedingChar = splitterMap[r - 1, c];
                char currentChar = parsedInputData[r][c];

                if ((precedingChar == 'S' || precedingChar == '|') && currentChar == '.')
                {
                    splitterMap[r, c] = '|';
                }
                else if (precedingChar == '|' && currentChar == '^')
                {
                    splitterMap[r, c - 1] = '|';
                    splitterMap[r, c] = currentChar;
                    splitterMap[r, c + 1] = '|';
                    c++;
                }
                else
                {
                    splitterMap[r, c] = currentChar;
                }
            }
        }

        long[,] pathsMap = new long[rows, cols];

        for (int r = 1; r < rows; r++)
        {
            for (int c = 0; c < cols; c++)
            {
                if (parsedInputData[r - 1][c] == 'S')
                {
                    pathsMap[r, c] = 1;
                }

                if (parsedInputData[r][c] == '^')
                {
                    continue;
                }

                if (c - 1 >= 0 && splitterMap[r, c - 1] == '^')
                {
                    pathsMap[r, c] += pathsMap[r - 1, c - 1];
                }

                if (c + 1 < cols && splitterMap[r, c + 1] == '^')
                {
                    pathsMap[r, c] += pathsMap[r - 1, c + 1];
                }

                pathsMap[r, c] += pathsMap[r - 1, c];
            }
        }

        // WriteMapToConsole(pathsMap);

        for (int c = 0; c < cols; c++)
        {
            accumulator += pathsMap[rows - 1, c];
        }

        return accumulator;
    }

    private void SolveChallenge2()
    {
        if (inputData != string.Empty)
        {
            try
            {
                challenge2Result = Challenge2Solution(inputData);
            }
            catch (Exception ex)
            {
                Console.WriteLine(ex.Message);
            }
        }
    }

    private void WriteMapToConsole(char[,] map)
    {
        for (int r = 0; r < map.GetLength(0); r++)
        {
            for (int c = 0; c < map.GetLength(1); c++)
            {
                Console.Write(map[r, c]);
            }
            Console.WriteLine();
        }
    }

    private void WriteMapToConsole(long[,] map)
    {
        // Find the max value in the long array
        long largestNumber = 0;
        for (int r = 0; r < map.GetLength(0); r++)
        {
            for (int c = 0; c < map.GetLength(1); c++)
            {
                if (map[r, c] > largestNumber)
                {
                    largestNumber = map[r, c];
                }
            }
        }
        int numberOfDigitsToPad = largestNumber.ToString().Length;

        for (int r = 0; r < map.GetLength(0); r++)
        {
            for (int c = 0; c < map.GetLength(1); c++)
            {
                Console.Write(map[r, c].ToString().PadLeft(numberOfDigitsToPad + 1) + "");
            }
            Console.WriteLine();
        }
    }
}
